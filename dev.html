<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            display: flex; justify-content: center; align-items: flex-start; height: 100vh;
            font-family: 'Helvetica Neue', Arial, sans-serif; background: #f4f4f4; color: #333;
            transition: background 0.3s, color 0.3s;
        }
        @media (prefers-color-scheme: dark) {
            body { background: #1e1e1e; color: #ffffff; }
        }
        .container { width: 90%; max-width: 800px; margin: 0 auto; }
        h1 { font-size: 2em; font-weight: bold; margin-bottom: 15px; text-align: center; }
        .CodeMirror {
            height: auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
            background: #ffffff; /* Default background for light mode */
            transition: background 0.3s;
        }
        @media (prefers-color-scheme: dark) {
            .CodeMirror { background: #2d2d2d; }
        }
        #controls {
            display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center;
        }
        button, select {
            padding: 10px; font-size: 1em; font-weight: bold; 
            background: #333; color: #fff; border: none; cursor: pointer; border-radius: 4px;
            transition: background 0.3s, transform 0.2s;
        }
        button:hover, select:hover { background: #444; }
        button:active { transform: scale(0.95); }
        #previewContainer {
            display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000; color: #fff; z-index: 1000; overflow: hidden;
            transition: opacity 0.3s ease;
        }
        #closeRunner {
            position: absolute; padding: 10px 15px;
            background: #ff5252; border: none; font-size: 1em; font-weight: bold; color: #fff; cursor: pointer;
            border-radius: 0px; transition: background 0.3s;
        }
        #closeRunner:hover { background: #ff3333; }
        #preview { width: 100%; height: 100%; border: none; }
        #searchContainer {
            display: flex; margin-top: 10px; justify-content: space-between;
        }
        #searchInput {
            flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px;
            margin-right: 5px; font-size: 1em;
        }
    </style>
</head>
<body>
    <div class="container" id="editor">
        <div id="controls">
            <button id="runButton" onclick="runCode()">Run</button>
            <select id="fileSelector" onchange="loadFile()">
                <option value="">Select a file</option>
            </select>
            <button id="newFileButton" onclick="newFile()">New File</button>
            <button id="homeButton" onclick="goHome()">Home</button>
        </div>
        <div id="codeMirrorContainer"></div>
        <div id="searchContainer">
            <input type="text" id="searchInput" placeholder="Search code..." />
            <button id="searchButton" onclick="searchCode()">Search</button>
        </div>
        <div id="buttonContainer" style="margin-top: 10px;">
            <button onclick="pasteCode()">Paste</button>
            <button onclick="clearCode()">Clear</button>
            <button onclick="copyCode()">Copy</button>
            <button onclick="downloadCode()">Download</button>
        </div>
    </div>
    
    <div id="previewContainer">
        <button id="closeRunner" onclick="closeRunner()">Close Runner</button>
        <iframe id="preview"></iframe>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    
    <script>
        let editor;
        let files = {};

        // Initialize CodeMirror
        window.onload = function() {
            editor = CodeMirror(document.getElementById("codeMirrorContainer"), {
                lineNumbers: true,
                mode: "text/html",
                theme: "default",
                autoCloseTags: true,
                matchBrackets: true,
                lineWrapping: true,
                styleActiveLine: true,
                viewportMargin: Infinity,
            });
        };

        function newFile() {
            const fileName = prompt("Enter file name (html, css, js):");
            if (fileName) {
                const extension = fileName.split('.').pop();
                let initialContent = '';

                switch (extension) {
                    case 'html':
                        initialContent = '<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>New HTML File</title>\n</head>\n<body>\n\n</body>\n</html>';
                        editor.setOption("mode", "text/html");
                        break;
                    case 'css':
                        initialContent = '/* New CSS File */\n\n';
                        editor.setOption("mode", "text/css");
                        break;
                    case 'js':
                        initialContent = '// New JavaScript File\n\n';
                        editor.setOption("mode", "text/javascript");
                        break;
                    default:
                        alert('Unsupported file type. Please enter a valid file name with html, css, or js extension.');
                        return;
                }

                files[fileName] = initialContent;
                updateFileSelector();
                loadFile(fileName);
            }
        }

        function updateFileSelector() {
            const fileSelector = document.getElementById("fileSelector");
            fileSelector.innerHTML = '<option value="">Select a file</option>';
            for (const file in files) {
                fileSelector.innerHTML += `<option value="${file}">${file}</option>`;
            }
        }

        function loadFile(fileName) {
            const selectedFile = fileName || document.getElementById("fileSelector").value;
            if (selectedFile) {
                editor.setValue(files[selectedFile]);
                editor.setOption("mode", getFileMode(selectedFile));
            }
        }

        function getFileMode(fileName) {
            const extension = fileName.split('.').pop();
            switch (extension) {
                case 'html':
                    return 'text/html';
                case 'css':
                    return 'text/css';
                case 'js':
                    return 'text/javascript';
                default:
                    return 'text/plain';
            }
        }

        async function pasteCode() {
            try {
                const text = await navigator.clipboard.readText();
                editor.setValue(text);
            } catch (err) {
                alert("Failed to paste: " + err);
            }
        }

        function clearCode() {
            editor.setValue('');
        }

        function copyCode() {
            const code = editor.getValue();
            navigator.clipboard.writeText(code).then(() => {
                alert("Code copied to clipboard!");
            });
        }

        function downloadCode() {
            const code = editor.getValue();
            const blob = new Blob([code], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'code.html'; // Default name, can be changed if necessary
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function runCode() {
            const code = editor.getValue();
            document.getElementById("preview").srcdoc = code;
            document.getElementById("editor").style.display = "none";
            document.getElementById("previewContainer").style.display = "block";
        }

        function closeRunner() {
            document.getElementById("editor").style.display = "block";
            document.getElementById("previewContainer").style.display = "none";
        }

        function searchCode() {
            const query = document.getElementById("searchInput").value;
            if (query) {
                const regex = new RegExp(query, "gi");
                const matches = editor.getValue().match(regex);
                if (matches) {
                    alert(`Found ${matches.length} occurrence(s) of "${query}".`);
                    // Highlighting logic can be added here
                } else {
                    alert(`No occurrences found for "${query}".`);
                }
            }
        }

        function goHome() {
            window.location.href = "https://adiasta.com";  // Redirects to Adiasta.com
        }
    </script>
</body>
</html>
