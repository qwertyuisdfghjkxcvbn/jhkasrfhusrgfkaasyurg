<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>San Francisco 3D Simulation</title>
  <style>
    body, html {
      margin: 0;
      overflow: hidden;
      height: 100%;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script>
  // Scene setup
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
  camera.position.set(0, 50, 150);
  camera.lookAt(0, 20, 0);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  document.body.appendChild(renderer.domElement);

  // Lighting
  const ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.6); // Soft ambient light
  scene.add(ambientLight);

  const sunlight = new THREE.DirectionalLight(0xFFFFFF, 1.2); // Sunlight
  sunlight.position.set(10, 50, 10).normalize();
  sunlight.castShadow = true;
  scene.add(sunlight);

  // Orbit Controls (for user navigation)
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.25;
  controls.screenSpacePanning = false;
  controls.maxPolarAngle = Math.PI / 2;

  // Create basic ground (simulating a city street/road)
  function createGround() {
    const groundGeometry = new THREE.PlaneGeometry(5000, 5000); // Large ground to simulate the city
    const groundMaterial = new THREE.MeshStandardMaterial({ color: 0xA9A9A9 });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -1;
    ground.receiveShadow = true;
    scene.add(ground);
  }

  // Create building with windows that may have light
  function createBuilding(x, z, width, height, depth) {
    const buildingGeometry = new THREE.BoxGeometry(width, height, depth);
    const buildingMaterial = new THREE.MeshStandardMaterial({ color: 0x8B8B8B });
    const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
    building.position.set(x, height / 2, z);
    building.castShadow = true;
    building.receiveShadow = true;
    scene.add(building);

    // Add windows with some having lights
    const windowGeometry = new THREE.PlaneGeometry(1, 2);
    const windowMaterial = new THREE.MeshBasicMaterial({ color: 0x87CEEB, transparent: true, opacity: 0.7 });
    for (let i = -width / 2 + 1; i < width / 2; i += 3) {
      for (let j = 0; j < height; j += 3) {
        const windowMesh = new THREE.Mesh(windowGeometry, windowMaterial);
        windowMesh.position.set(x + i, j, z + depth / 2 + 0.1);
        scene.add(windowMesh);

        // Randomly decide to light up some windows
        if (Math.random() > 0.7) {
          const litWindowMaterial = new THREE.MeshBasicMaterial({ color: 0xFFFF00, transparent: true, opacity: 0.5 });
          windowMesh.material = litWindowMaterial;
        }
      }
    }
  }

  // Create trees to simulate city parks
  function createTree(x, z) {
    const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.5, 7);
    const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
    const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
    trunk.position.set(x, 3.5, z);
    trunk.castShadow = true;
    trunk.receiveShadow = true;
    scene.add(trunk);

    const foliageGeometry = new THREE.SphereGeometry(4, 16, 16);
    const foliageMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22 });
    const foliage = new THREE.Mesh(foliageGeometry, foliageMaterial);
    foliage.position.set(x, 8, z);
    foliage.castShadow = true;
    foliage.receiveShadow = true;
    scene.add(foliage);
  }

  // Create cars with movement
  const cars = [];
  function createCar(x, z) {
    const carGeometry = new THREE.BoxGeometry(3, 2, 6);
    const carMaterial = new THREE.MeshStandardMaterial({ color: Math.random() * 0xffffff });
    const car = new THREE.Mesh(carGeometry, carMaterial);
    car.position.set(x, 1, z);
    car.castShadow = true;
    cars.push(car);
    scene.add(car);
  }

  function moveCars() {
    cars.forEach(car => {
      car.position.x += 0.2; // Moves the car along x-axis
      if (car.position.x > 100) car.position.x = -100; // Reset position for continuous loop
    });
  }

  // Create simple people models
  function createPerson(x, z) {
    const bodyGeometry = new THREE.CylinderGeometry(0.5, 0.5, 3);
    const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0xffd700 });
    const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
    body.position.set(x, 1.5, z);
    scene.add(body);

    const headGeometry = new THREE.SphereGeometry(0.5);
    const headMaterial = new THREE.MeshStandardMaterial({ color: 0xffe4b5 });
    const head = new THREE.Mesh(headGeometry, headMaterial);
    head.position.set(x, 3.5, z);
    scene.add(head);
  }

  // Create a simple park with benches
  function createPark(x, z) {
    const parkGeometry = new THREE.PlaneGeometry(30, 20);
    const parkMaterial = new THREE.MeshStandardMaterial({ color: 0x32cd32 });
    const park = new THREE.Mesh(parkGeometry, parkMaterial);
    park.rotation.x = -Math.PI / 2;
    park.position.set(x, 0, z);
    park.receiveShadow = true;
    scene.add(park);

    createTree(x + 5, z + 5);
    createTree(x - 5, z -5);
  }

  // Adding ground, roads, and park
  createGround();
  createPark(-20, -30);

  // Adding buildings, cars, trees, and people
  for (let i = 0; i < 5; i++) {
    const width = Math.random() * 10 + 10;
    const height = Math.random() * 30 + 20;
    const depth = Math.random() * 10 + 10;
    createBuilding(Math.random() * 100 - 50, Math.random() * 100 - 50, width, height, depth);
    createCar(Math.random() * 100 - 50, Math.random() * 100 - 50);
    createPerson(Math.random() * 100 - 50, Math.random() * 100 - 50);
  }

  // Adding Fog to mimic the San Francisco atmosphere
  scene.fog = new THREE.FogExp2(0x87CEEB, 0.01);

  // Resize handler for responsiveness
  window.addEventListener('resize', () => {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
  });

  // Animation loop
  function animate() {
    requestAnimationFrame(animate);
    moveCars(); // Move cars in the scene
    controls.update();
    renderer.render(scene, camera);
  }

  animate();
</script>

</body>
</html>