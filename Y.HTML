<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Exam Preparator</title>
<style>
body {
  margin: 0; padding: 0; 
  background: #111; 
  color: #eee;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
}
header {
  display: flex; 
  align-items: center; 
  justify-content: space-between;
  padding: 1rem; 
  border-bottom: 1px solid #333;
}
header h1 {
  font-size: 1.2rem; 
  margin: 0; 
  font-weight: 600;
}
header button {
  background: none; 
  border: none; 
  cursor: pointer; 
  color: #0af;
  font-size: 1.5rem;
}
main {
  padding: 1rem; 
  max-width: 600px; 
  margin: 0 auto;
}
.new-set-form, .update-progress-form {
  display: flex; 
  gap: 0.5rem; 
  margin-bottom: 1rem; 
  align-items: center;
}
input[type="number"], input[type="text"] {
  background: #222; 
  border: 1px solid #333; 
  color: #eee; 
  padding: 0.5rem; 
  border-radius: 0.3rem; 
  width: 5rem;
}
input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button {
  -webkit-appearance: none; 
  margin: 0;
}
button.action {
  background: #0af; 
  border: none; 
  color: #111; 
  font-weight: 600; 
  padding: 0.5rem 0.7rem; 
  border-radius: 0.3rem; 
  cursor: pointer;
}
button.action:active {
  background: #08d;
}
.sets {
  display: flex; 
  flex-direction: column; 
  gap: 1rem;
}
.set {
  border: 1px solid #333; 
  border-radius: 0.3rem; 
  padding: 1rem; 
  background: #222;
}
.set-header {
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  margin-bottom: 0.5rem;
  font-weight: 600;
}
.set-header button {
  background: none; 
  border: none; 
  color: #f33; 
  cursor: pointer; 
  font-size: 1rem;
}
.set-details {
  font-size: 0.9rem; 
  margin-bottom: 0.5rem;
}
.set-details div {
  margin: 0.2rem 0;
}
progress {
  width: 100%; 
  height: 1rem; 
  border: none; 
  border-radius: 0.3rem; 
  background: #333;
}
progress::-webkit-progress-value {
  background: #0af;
  border-radius: 0.3rem;
}
.update-progress-form button {
  background: #0a8; 
  border: none; 
  color: #111; 
  font-weight: 600; 
  padding: 0.3rem 0.7rem; 
  border-radius: 0.3rem; 
  cursor: pointer;
}
.update-progress-form button:active {
  background: #07a;
}
.overlay-message {
  position:fixed;top:0;left:0;width:100%;height:100%;background:#111;display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column;text-align:center;color:#fff;padding:20px;font-size:1.2rem
}
.overlay-message p{margin-bottom:10px}
</style>
</head>
<body>
<div class="overlay-message" id="overlayMessage">
<p>Please open this on iPhone</p>
</div>
<header>
  <h1>Exam Preparator</h1>
  <button id="addSetBtn" title="Add New Preparation Set">+</button>
</header>
<main>
  <form class="new-set-form" id="newSetForm" style="display:none;">
    <input type="number" id="totalTests" placeholder="Tests" min="1" required>
    <input type="number" id="totalDays" placeholder="Days" min="1" required>
    <button class="action" type="submit">Create</button>
  </form>
  <div class="sets" id="setsContainer"></div>
</main>
<script>
(function(){
  let sets = JSON.parse(localStorage.getItem('examPreparatorSets') || '[]');
  const setsContainer = document.getElementById('setsContainer');
  const addSetBtn = document.getElementById('addSetBtn');
  const newSetForm = document.getElementById('newSetForm');
  const totalTestsInput = document.getElementById('totalTests');
  const totalDaysInput = document.getElementById('totalDays');
  const overlayMessage=document.getElementById('overlayMessage');

  function isiOS(){return/iphone|ipad|ipod/i.test(navigator.userAgent)}
  function checkDevice(){
    if(!isiOS()||window.innerWidth>600){overlayMessage.style.display='flex'}else{overlayMessage.style.display='none'}
  }
  checkDevice();
  window.addEventListener('resize',checkDevice);

  function saveSets() {
    localStorage.setItem('examPreparatorSets', JSON.stringify(sets));
  }

  function renderSets() {
    setsContainer.innerHTML = '';
    sets.forEach((s, index) => {
      const done = s.done || 0;
      const total = s.total;
      const daysLeft = s.days;
      const testsLeft = Math.max(total - done, 0);
      const testsPerDay = daysLeft > 0 ? Math.ceil(testsLeft / daysLeft) : 0;
      const progress = (done / total)*100;

      const setEl = document.createElement('div');
      setEl.className = 'set';
      setEl.innerHTML = `
        <div class="set-header">
          <div>Set #${index+1}</div>
          <button title="Remove Set">&times;</button>
        </div>
        <div class="set-details">
          <div>Total tests: ${total}</div>
          <div>Days: ${daysLeft}</div>
          <div>Tests done: ${done}</div>
          <div>Tests left: ${testsLeft}</div>
          <div>Tests/day needed: ${testsPerDay}</div>
          <div>Your Progress: ${progress.toFixed(1)}%</div>
          <progress value="${done}" max="${total}"></progress>
        </div>
        <form class="update-progress-form">
          <input type="number" min="1" placeholder="Tests done today" required>
          <button type="submit">Update</button>
        </form>
      `;

      const removeBtn = setEl.querySelector('.set-header button');
      removeBtn.addEventListener('click', () => {
        sets.splice(index,1);
        saveSets();
        renderSets();
      });

      const updateForm = setEl.querySelector('.update-progress-form');
      updateForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const val = parseInt(updateForm.querySelector('input').value,10);
        if(isNaN(val) || val <= 0) return;
        s.done += val;
        if(s.done > s.total) s.done = s.total;
        saveSets();
        renderSets();
      });

      setsContainer.appendChild(setEl);
    });
  }

  addSetBtn.addEventListener('click', () => {
    if (newSetForm.style.display === 'none') {
      newSetForm.style.display = 'flex';
    } else {
      newSetForm.style.display = 'none';
    }
  });

  newSetForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const totalTests = parseInt(totalTestsInput.value,10);
    const totalDays = parseInt(totalDaysInput.value,10);
    if (isNaN(totalTests) || isNaN(totalDays) || totalTests <= 0 || totalDays <= 0) return;
    sets.push({total: totalTests, days: totalDays, done: 0});
    saveSets();
    renderSets();
    totalTestsInput.value = '';
    totalDaysInput.value = '';
    newSetForm.style.display = 'none';
  });

  renderSets();
})();
</script>
</body>
</html>
