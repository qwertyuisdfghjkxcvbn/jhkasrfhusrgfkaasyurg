
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Exam Preparator</title>
<style>
/* Use deviceâ€™s preferred color scheme */
:root {
  color-scheme: light dark;
}

body, html {
  margin:0; padding:0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
  overflow-x:hidden;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  body { background:#111; color:#eee; }
  header, .set, .new-set-form, .confirm-modal .modal-content {
    background:#222; border:1px solid #333;
  }
  input, button.action {
    background:#333; color:#eee; border:1px solid #444;
  }
  progress { background:#333; }
  progress::-webkit-progress-value { background:#0af; }
}

/* Light mode */
@media (prefers-color-scheme: light) {
  body { background:#f5f5f5; color:#111; }
  header, .set, .new-set-form, .confirm-modal .modal-content {
    background:#fff; border:1px solid #ccc;
  }
  input, button.action {
    background:#eee; color:#111; border:1px solid #ccc;
  }
  progress { background:#ccc; }
  progress::-webkit-progress-value { background:#06c; }
}

header {
  display:flex; align-items:center; justify-content:space-between;
  padding:1rem; box-sizing:border-box;
}
header h1 {
  margin:0; font-size:1.2rem; font-weight:600;
}
header button {
  background:none; border:none; color:#0af; font-size:1.5rem; cursor:pointer;
}

main {
  padding:1rem; max-width:600px; margin:0 auto; box-sizing:border-box; width:100%;
}

.new-set-form {
  display:none; flex-direction:column; gap:0.5rem; margin-bottom:1rem; align-items:stretch;
}
.new-set-form input {
  padding:0.5rem; border-radius:0.3rem; font-size:1rem;
}
.new-set-form button.action {
  font-weight:600; padding:0.5rem; border-radius:0.3rem;
}

.sets {
  display:flex; flex-direction:column; gap:1rem; margin-top:1rem;
}

.set {
  border-radius:0.3rem; padding:1rem; display:flex; flex-direction:column; gap:0.5rem;
}

.set-header {
  display:flex; justify-content:space-between; align-items:center; gap:0.5rem;
}
.set-header input {
  border-radius:0.3rem; padding:0.3rem; flex:1;
}
.set-header button {
  background:none; border:none; color:#f33; cursor:pointer; font-size:1.2rem; width:2rem; height:2rem; text-align:center; line-height:2rem; border-radius:0.3rem;
}
.set-header button:hover {
  background:#f33; color:#fff;
}

.set-details {
  font-size:0.9rem; display:flex; flex-direction:column; gap:0.2rem;
}
progress {
  width:100%; height:1rem; border-radius:0.3rem; border:none;
}

.schedule {
  margin-top:0.5rem; font-size:0.9rem;
}
.schedule-day {
  display:flex; justify-content:space-between; margin-bottom:0.2rem;
}

.update-progress-form {
  display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;
}
.update-progress-form input[type="number"] {
  width:4rem; border-radius:0.3rem; padding:0.3rem;
}
.update-progress-form button.action {
  border:none; font-weight:600; padding:0.3rem 0.7rem; border-radius:0.3rem; cursor:pointer;
  background:#0af; color:#111;
}
.update-progress-form button.action:active {
  background:#08d;
}
.update-progress-form .increment-button {
  width:2rem; height:2rem; border-radius:0.3rem; background:#0af; color:#111; font-size:1.2rem; line-height:2rem; text-align:center; border:none; cursor:pointer;
}

.confirm-modal {
  position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);
  display:none; align-items:center; justify-content:center; z-index:9999;
}
.confirm-modal .modal-content {
  padding:1rem; border-radius:0.3rem; text-align:center; max-width:300px; margin:0 auto;
}
.confirm-modal .modal-content p {
  margin-bottom:1rem;
}
.confirm-modal .modal-content button {
  margin:0 0.5rem; padding:0.5rem 1rem; border-radius:0.3rem; cursor:pointer;
}
</style>
</head>
<body>
<header>
  <h1>Exam Preparator</h1>
  <button id="addSetBtn">+</button>
</header>
<main>
  <form class="new-set-form" id="newSetForm">
    <input type="text" id="setName" placeholder="Set Name" required>
    <input type="number" id="totalTests" placeholder="Total Tests" min="1" required>
    <input type="number" id="totalDays" placeholder="Days" min="1" required>
    <button class="action" type="submit">Create</button>
  </form>
  <div class="sets" id="setsContainer"></div>
</main>
<div class="confirm-modal" id="confirmModal">
  <div class="modal-content">
    <p>Remove this set?</p>
    <button id="confirmRemoveYes">Yes</button>
    <button id="confirmRemoveNo">No</button>
  </div>
</div>
<script>
(function(){
  let sets = JSON.parse(localStorage.getItem('examPreparatorSets') || '[]');
  let removeIndex = null;

  const newSetForm = document.getElementById('newSetForm');
  const setsContainer = document.getElementById('setsContainer');
  const addSetBtn = document.getElementById('addSetBtn');
  const confirmModal = document.getElementById('confirmModal');
  const confirmRemoveYes = document.getElementById('confirmRemoveYes');
  const confirmRemoveNo = document.getElementById('confirmRemoveNo');

  function saveSets() {
    localStorage.setItem('examPreparatorSets', JSON.stringify(sets));
  }

  // Distribute tests as evenly as possible across days
  function createSchedule(totalTests, totalDays) {
    let schedule = new Array(totalDays).fill(0);
    for (let i = 1; i <= totalTests; i++) {
      let dayIndex = Math.round(i*(totalDays/(totalTests+1))) - 1;
      if (dayIndex < 0) dayIndex = 0;
      if (dayIndex >= totalDays) dayIndex = totalDays-1;
      schedule[dayIndex] += 1;
    }
    return schedule;
  }

  function addDaysToDate(date, days) {
    let result = new Date(date);
    result.setDate(result.getDate() + days);
    return result;
  }

  function formatDate(date) {
    return date.toDateString();
  }

  function renderSets() {
    setsContainer.innerHTML = '';
    sets.forEach((s, index) => {
      const done = s.done || 0;
      const total = s.total;
      const testsLeft = Math.max(total - done, 0);
      const daysLeft = s.days;
      const testsPerDay = daysLeft > 0 ? Math.ceil(testsLeft / daysLeft) : 0;
      const progress = (done / total)*100;
      const schedule = s.schedule || [];
      const startDate = new Date(s.startDate);
      const finishDate = addDaysToDate(startDate, s.days);

      const setEl = document.createElement('div');
      setEl.className = 'set';
      setEl.innerHTML = `
        <div class="set-header">
          <input type="text" value="${s.name}" data-index="${index}" title="Rename this set"/>
          <button title="Remove Set">&times;</button>
        </div>
        <div class="set-details">
          <div>Total: ${total}</div>
          <div>Done: ${done}</div>
          <div>Left: ${testsLeft}</div>
          <div>Tests/Day: ${testsPerDay}</div>
          <div>Finish by: ${formatDate(finishDate)}</div>
          <progress value="${done}" max="${total}"></progress>
        </div>
        <div class="schedule">
          <strong>Schedule:</strong>
          ${schedule.map((testsCount, dayIndex) => `
            <div class="schedule-day">
              <div>Day ${dayIndex+1}:</div>
              <div>${testsCount} test${testsCount!==1?'s':''}</div>
            </div>
          `).join('')}
        </div>
        <form class="update-progress-form">
          <input type="number" min="0" value="0" required>
          <button type="button" class="increment-button">+</button>
          <button type="submit" class="action">Update</button>
        </form>
      `;

      const removeBtn = setEl.querySelector('.set-header button');
      removeBtn.addEventListener('click', () => {
        removeIndex = index;
        confirmModal.style.display = 'flex';
      });

      const nameInput = setEl.querySelector('.set-header input');
      nameInput.addEventListener('change', () => {
        s.name = nameInput.value.trim();
        saveSets();
      });

      const updateForm = setEl.querySelector('.update-progress-form');
      const updateInput = updateForm.querySelector('input[type="number"]');
      const incrementBtn = updateForm.querySelector('.increment-button');
      incrementBtn.addEventListener('click', () => {
        let val = parseInt(updateInput.value, 10) || 0;
        updateInput.value = val + 1;
      });

      updateForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const val = parseInt(updateInput.value,10);
        if(isNaN(val) || val < 0) return;
        s.done += val;
        if(s.done > s.total) s.done = s.total;
        saveSets();
        renderSets();
      });

      setsContainer.appendChild(setEl);
    });
  }

  addSetBtn.addEventListener('click', () => {
    newSetForm.style.display = newSetForm.style.display === 'none' || newSetForm.style.display === '' ? 'flex' : 'none';
  });

  newSetForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.getElementById('setName').value.trim();
    const totalTests = parseInt(document.getElementById('totalTests').value,10);
    const totalDays = parseInt(document.getElementById('totalDays').value,10);
    if(!name || isNaN(totalTests) || isNaN(totalDays) || totalTests <=0 || totalDays <=0) return;
    const schedule = createSchedule(totalTests, totalDays);
    sets.push({name, total: totalTests, days: totalDays, done:0, schedule, startDate: new Date().toISOString()});
    saveSets();
    renderSets();
    document.getElementById('setName').value = '';
    document.getElementById('totalTests').value = '';
    document.getElementById('totalDays').value = '';
    newSetForm.style.display = 'none';
  });

  confirmRemoveYes.addEventListener('click', () => {
    if(removeIndex !== null) {
      sets.splice(removeIndex,1);
      saveSets();
      renderSets();
      removeIndex = null;
    }
    confirmModal.style.display='none';
  });

  confirmRemoveNo.addEventListener('click', () => {
    confirmModal.style.display='none';
    removeIndex=null;
  });

  // Initialize
  renderSets();
})();
</script>
</body>
</html>
